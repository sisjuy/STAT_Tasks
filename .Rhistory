for(i in c(1:56)){
print(i)
}
filterdata <- function(state,sex){
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
}
for(i in c(1:56)){
#state 1:56
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(i in c(1:56)){
#state 1:56
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
setwd("D:/大四上/internship/中研院兼任研究助理/統計所/week3-data+Fhat_plot")
state=1
sex=2
dir.create(paste0("data/","STATE/",as.character(state),"/",
as.character(ifelse(sex==1,"male","female"))))
dir.create(paste0("data/","STATE/",as.character(state),"/",
as.character(ifelse(sex==1,"male","female"))))
for(i in c(1:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(i in c(1:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
datafilter <- function(accident_path, person_path, output, state,sex){
beforedata1  = read_csv(accident_path, col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == state) #California(CA)
beforedata2  = read_csv(person_path, col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == state) #California(CA)
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = step2[order(step2[,44]),] #order by state-case number(ST_CASE)
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == sex) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
write_csv(step6,file=output)
}
filterdata <- function(state,sex){
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
}
for(i in c(1:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(i in c(3:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(i in c(3:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
datafilter <- function(accident_path, person_path, output, state,sex){
beforedata1  = read_csv(accident_path, col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == state) #California(CA)
beforedata1 = na.omit(beforedata1)
beforedata2  = read_csv(person_path, col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == state) #California(CA)
beforedata2 = na.omit(beforedata2)
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = step2[order(step2[,44]),] #order by state-case number(ST_CASE)
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == sex) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
write_csv(step6,file=output)
}
for(i in c(3:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(i in c(3:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(i)))
for(j in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(j==1,"male","female"))))
filterdata(i,j)
}
}
for(ii in c(3:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
sex=1
state=3
sex=1
dir.create(paste0("data/","STATE/",as.character(state),"/",
as.character(ifelse(sex==1,"male","female"))))
filterdata <- function(state,sex){
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
}
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
state=4
sex=1
dir.create(paste0("data/","STATE/",as.character(state),"/",
as.character(ifelse(sex==1,"male","female"))))
for(ii in c(4:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
setwd("D:/大四上/internship/中研院兼任研究助理/統計所/week3-data+Fhat_plot")
datafilter <- function(accident_path, person_path, output, state,sex){
beforedata1  = read_csv(accident_path, col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == state) #California(CA)
beforedata2  = read_csv(person_path, col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == state) #California(CA)
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = step2[order(step2[,44]),] #order by state-case number(ST_CASE)
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == sex) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
write_csv(step6,file=output)
}
filterdata <- function(state,sex){
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
}
for(ii in c(4:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
for(ii in c(4:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(i),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
for(ii in c(4:56)){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
d = read_csv(accident_path, col_names=T, skip = 0)
x = unique(d$STATE)
}
x
x = {}
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
d = read_csv(accident_path, col_names=T, skip = 0)
x = append(x,unique(d$STATE))
}
x
51*7
51*6
for(i in c(2009:2014)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
d = read_csv(accident_path, col_names=T, skip = 0)
x = unique(d$STATE)
}
x
x
x[-(1:5)]
for(ii in x[-(1:5)]){
#state 1:56
dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
beforedata1  = read_csv("data/2009/ACCIDENT.CSV", col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == 6) #California(CA)
beforedata2  = read_csv("data/2009/PERSON.CSV", col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == 6) #California(CA)
#step1 = filter(beforedata1, ROUTE == 1) #interstate highway #without? OK 0802
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2[,44]
beforedata1  = read_csv("data/2013/ACCIDENT.CSV", col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == 6) #California(CA)
beforedata2  = read_csv("data/2013/PERSON.CSV", col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == 6) #California(CA)
#step1 = filter(beforedata1, ROUTE == 1) #interstate highway #without? OK 0802
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2[,44]
step2$ST_CASE
step2 = step2[order(step2$ST_CASE),] #order by state-case number(ST_CASE)
step2
step2 = step2[order(step2[,44]),] #order by state-case number(ST_CASE)
step2
beforedata1  = read_csv("data/2013/ACCIDENT.CSV", col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == 6) #California(CA)
beforedata2  = read_csv("data/2013/PERSON.CSV", col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == 6) #California(CA)
#step1 = filter(beforedata1, ROUTE == 1) #interstate highway #without? OK 0802
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2$ST_CASE
step2 = step2[order(step2$ST_CASE),] #order by state-case number(ST_CASE)
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == 1) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
#filter(step3, HARM_EV != 23) #appendex: if harmful event=23 then interstate highway should not =1
step6
beforedata1  = read_csv("data/2014/ACCIDENT.CSV", col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == 6) #California(CA)
beforedata2  = read_csv("data/2014/PERSON.CSV", col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == 6) #California(CA)
#step1 = filter(beforedata1, ROUTE == 1) #interstate highway #without? OK 0802
step2a = filter(beforedata1, ROAD_FNC == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 11) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = step2[order(step2$ST_CASE),] #order by state-case number(ST_CASE)
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
View(beforedata2)
step4 = filter(step3, SEX == 1) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
#filter(step3, HARM_EV != 23) #appendex: if harmful event=23 then interstate highway should not =1
step6
library(dplyr)
rm(list=ls(all=TRUE))
beforedata1  = read_csv("data/2015/ACCIDENT.CSV", col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == 6) #California(CA)
beforedata2  = read_csv("data/2015/PERSON.CSV", col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == 6) #California(CA)
step2a = filter(beforedata1, RUR_URB == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_FNC == 2) #Urban Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_URB == 2) #Urban Principal Arterial-Interstate
step2a = filter(beforedata1, RUR_URB == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, ROAD_URB == 2) #Urban Principal Arterial-Interstate
step2b = filter(beforedata1, RUR_URB == 2) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = filter(step2, FUNC_SYS == 1)
step2 = step2[order(step2$ST_CASE),] #order by state-case number(ST_CASE)
step2$ST_CASE
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == 1) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
step6
step6$RUR_URB
nrow(step6)
#for 2015~
datafilter1 <- function(accident_path, person_path, output, state,sex){
beforedata1  = read_csv(accident_path, col_names=T, skip = 0)
beforedata1 = filter(beforedata1, STATE == state) #California(CA)
beforedata2  = read_csv(person_path, col_names=T, skip = 0)
beforedata2 = filter(beforedata2, STATE == state) #California(CA)
step2a = filter(beforedata1, RUR_URB == 1) #Rural Principal Arterial-Interstate
step2b = filter(beforedata1, RUR_URB == 2) #Urban Principal Arterial-Interstate
step2 = rbind(step2a,step2b)
step2 = filter(step2, FUNC_SYS == 1)
step2 = step2[order(step2$ST_CASE),]
step3 = data.frame() #combine two tables by state-case number(ST_CASE)
for (i in c(1:nrow(step2))){
for (j in c(1:nrow(beforedata2))){
if (beforedata2$ST_CASE[j] == step2$ST_CASE[i]){
tempdata = beforedata2[j,]
step3 = rbind(step3, tempdata)
}
if (beforedata2$ST_CASE[j] > step2$ST_CASE[i]){
break
}
}
}
step4 = filter(step3, SEX == sex) #sex = male
step5 = filter(step4, ATST_TYP == 1) #alcohol test = Blood
step6 = filter(step5, ALC_RES >= 1, ALC_RES < 96) #BAC>=0.01%
write_csv(step6,file=output)
}
filterdata <- function(state,sex){
for(i in c(2015:2019)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter(accident_path,person_path,output,state,sex)
}
}
for(i in c(2015:2019)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
d = read_csv(accident_path, col_names=T, skip = 0)
x = unique(d$STATE)
}
x
for(ii in x[-(1:5)]){
#state 1:56
#dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
filterdata <- function(state,sex){
for(i in c(2015:2019)){
accident_path = paste0("data/",as.character(i),"/ACCIDENT.csv")
person_path = paste0("data/",as.character(i),"/PERSON.csv")
output = paste0("data/","STATE/",as.character(state),
"/",as.character(ifelse(sex==1,"male","female")),
"/",as.character(i),"data.csv")
datafilter1(accident_path,person_path,output,state,sex)
}
}
for(ii in x){
#state 1:56
#dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
for(ii in c(48:48)){
#state 1:56
#dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:1)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
x
x[-c(1:9),]
x[-c(1:9)]
for(ii in x[-c(1:9)]){
#state 1:56
#dir.create(paste0("data/","STATE/",as.character(ii)))
for(jj in c(1:2)){
dir.create(paste0("data/","STATE/",as.character(ii),"/",
as.character(ifelse(jj==1,"male","female"))))
filterdata(ii,jj)
}
}
